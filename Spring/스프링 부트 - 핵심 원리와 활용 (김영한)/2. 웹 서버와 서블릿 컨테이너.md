 # 외장 서버 VS 내장 서버
 
![image](https://user-images.githubusercontent.com/74352543/224260795-59f2b9ff-8d33-473e-b104-bbdf6a14145a.png)

**전통적인 방식**

과거에 자바로 웹 어플리케이션을 개발할 때는 먼저 서버에 톰캣 같은 WAS(웹 어플리케이션 서버)를 설치했다. 그리고 WAS에서 동작하도록 서브릿 스펙에 맞추어 코드를 작성하고 WAS 형식으로 빌드해서 war 파일을 만들었다. 이렇게 만들어진 war 파일을 WAS에 전달해서 배포하는 방식으로 전체 개발 주기가 동작했다.

이러한 방식은 WAS 기반위에서 개발하고 실행해야 한다. IDE 같은 개발 환경에서도 WAS와 연동해서 실행되도록 복잡한 추가 설정이 필요하다.

**최근 방식**

최근에는 스프링 부트가 내장 톰캣을 포함하고 있다. 애플리케이션 코드 안에 톰캣 같은 WAS가 라이브러리로 내장되어 있다는 뜻이다. 개발자는 코드를 작성하고 JAR로 빌드한 다음에 해당 JAR를 원하는 위치에서 실행하기만 하면 WAS도 함께 실행된다.

직접 전통적인 방식으로 해보고 어떻게 돌아가는지 알아보자

# JAR, WAR 간단 소개

**JAR**

자바는 여러 클래스와 리소스를 묶어서 JAR라고 하는 압축 파일을 만들 수 있다.

이 파일은 JVM 위에서 직접 실행되거나 또는 다른 곳에서 사용하는 라이브러리로 제공된다.

직접 실행하는 경우 'main ()' 메서드가 필요하고, 'MANIFEST.MF'파일에 실행할 메인 메서드가 있는 클래스를 지정해두어야 한다.

실행 예) 'java -jar abc.jar'

Jar는 쉽게 이야기해서 클래스와 관련 리소스를 압축한 단순하 파일이다. 필요한 경우 이 파일을 직접 실행할 수도 있고, 다른 곳에서 라이브러리로 사용할 수도 있다.

**WAR**
WAR(Web Application Archive)라는 이름에서 알 수 있듯 WAR 파일은 웹 애플리케이션 서버(WAS)에 배포할 때 사용하는 파일이다.

JAR 파일이 JVM위에서 실행된다면, WAR는 웹 어플리케이션 서버 위에서 실행된다.

웹 애플리케이션 서버 위에서 실행되고, HTML 같은 정적 리소스와 클래스 파일을 모두 함께 포함하기 때문에 JAR와 비교해서 구조가 더 복잡하다.

그리고 WAR 구조를 지켜야 한다.

# 서블릿 컨테이너 초기화1

* WAS를 실행하는 시점에 필요한 초기화 작업들이 있다. 서비스에 필요한 필터와 서블릿을 등록하고, 여기에 스프링을 사용한다면 스프링 컨테이너를 만들고, 서블릿과 스프링을 연결하는 디스패처 서블릿도 등록해야 한다.
* WAS가 제공하는 초기화 기능을 사용하면, WAS 실행 시점에 이러한 초기화 과정을 진행할 수 있다.
* 과거에는 'web.xml'을 사용해서 초기화했지만, 지금은 서블릿 스펙에서 자바 코드를 사용한 초기화도 지원한다.

**서블릿 컨테이너 초기화 개발**
* 서블릿은 ServletContainerInitializer라는 초기화 인터페이스를 제공함 이름 그대로 서블릿 컨테이너를 초기화 하는 기능을 제공하낟.
* 서블릿 컨테이너는 실행 시점에 초기화 메서드인 onStartup()을 호출해준다. 여기서 애플리케이션에 필요한 기능들을 초기화 하거나 등록할 수 있다.

**애플리케이션 초기화 **
* 서블릿 컨테이너는 조금 더 유연한 초기화 기능을 지원한다.
* 여기서는 이것을 애플리케이션 초기화라고 부르겠다.

**서블릿 컨테이너 초기화 말고 애플리케이션 초기화라는 개념을 만든 이유**
* 서블릿 컨테이너를 초기화 하려면 ServletContainerInitializer 인터페이스를 구현한 코드를 만들어야 한다. 여기에 추가로 META-INF/services/jakarta.servlet.ServletContainerInitializer 파일에 해당 코드를 직접 지정해주어야 한다.
* 애플리케이션 초기화는 특정 인터페이스만 구현하면 된다.
* 애플리케이션 초기화는 서블릿 컨테이너에 상관없이 원하는 모양으로 인터페이스를 만들 수 있다. 이를 통해 애플리케이션 초기화 코드가 서블릿 컨테이너에 대한 의존을 줄일 수 있다. 특히ServletContext ctx 가 필요없는 애플리케이션 초기화 코드라면 의존을 완전히 제거할 수도 있다.

# 스프링 컨테이너 등록

스프링 컨테이너 등록하는데 다음과 같은 과정이 필요함
* 스프링 컨테이너 만들기
* 스프링MVC 컨트롤러를 스프링 컨테이너에 빈으로 등록하기
* 스프링MVC를 사용하는데 필요한 디스패처 서블릿을 서블릿 컨테이너 등록하기

**중간에 코드로 서블릿 초기화를 사용해서 등록, 스프링 컨테이너 생성 등록, 스프링 MVC가 동작하도록 디스패처 서블릿 연결하는 거는 굳이 알필요없을듯**

# 정리
지금까지 서블릿 컨테이너 초기화를 사용해서 필요한 서블릿도 등로갛고, 스프링 컨테이너도 생성해서 등록하고 또 스프링 MVC가 동작하도록 디스패처 서블릿도 중간에 연결하였다. 그리고 스프링이 제공하는 좀 더 편리한 초기화 방법도 알아봄

지금까지 알아 본 내용은 모두 서블릿 컨테이너 위에서 동작하는 방법이다. 따라서 항상 톰캣 같은 서블릿 컨테이너에 배포를 해야만 동작하는 방식이다.

과거에는 서블릿 컨테이너 위에서 모든 것이 동작했지만, 스프링 부트와 내장 톰캣을 사용하면서 이런 부분이 바뀌기 시작했다.

